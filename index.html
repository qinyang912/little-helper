<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â­ å°å¸®æ‰‹ç§¯åˆ†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'å¾®è½¯é›…é»‘', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 36px;
            color: #ff6b9d;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .score-display {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .score-display::before {
            content: 'â­';
            font-size: 100px;
            position: absolute;
            right: -20px;
            top: -20px;
            opacity: 0.2;
        }

        .score-number {
            font-size: 72px;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }

        .score-label {
            font-size: 24px;
            color: white;
            margin-top: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            font-size: 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            transform: scale(1.05);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chore-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chore-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .chore-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .chore-icon {
            font-size: 48px;
            background: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .chore-details h3 {
            font-size: 24px;
            color: #333;
            margin-bottom: 5px;
        }

        .chore-points {
            font-size: 20px;
            color: #ff6b9d;
            font-weight: bold;
        }

        .complete-btn {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        .complete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .reward-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .reward-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .reward-icon {
            font-size: 40px;
        }

        .reward-info h3 {
            font-size: 22px;
            color: #333;
        }

        .reward-cost {
            font-size: 18px;
            color: #ff6b9d;
            font-weight: bold;
        }

        .redeem-btn {
            width: 100%;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border: none;
            padding: 12px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .redeem-btn:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .redeem-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .add-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 20px;
            width: 100%;
            transition: all 0.3s;
        }

        .add-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 10px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #999;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #ff6b9d;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
        }

        .emoji-picker::-webkit-scrollbar {
            width: 8px;
        }

        .emoji-picker::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .emoji-picker::-webkit-scrollbar-thumb {
            background: #ff6b9d;
            border-radius: 10px;
        }

        .emoji-picker::-webkit-scrollbar-thumb:hover {
            background: #ff4576;
        }

        .emoji-option {
            font-size: 36px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .emoji-option:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }

        .emoji-option.selected {
            border-color: #ff6b9d;
            background: #ffe0eb;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 100px;
            z-index: 2000;
            animation: celebrate 1s ease-out;
            pointer-events: none;
        }

        @keyframes celebrate {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            background: #ff4757;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            line-height: 24px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>â­ å°å¸®æ‰‹ç§¯åˆ†ç³»ç»Ÿ â­</h1>
        </div>

        <!-- æ¨¡å¼åˆ‡æ¢ -->
        <div style="margin-bottom: 20px; text-align: center;">
            <button id="parentModeBtn" onclick="switchMode('parent')" style="padding: 12px 30px; border: 3px solid #ff6b9d; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 0 5px;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶é•¿ç«¯</button>
            <button id="childModeBtn" onclick="switchMode('child')" style="padding: 12px 30px; border: 3px solid #e0e0e0; background: white; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; margin: 0 5px;">ğŸ‘¶ å„¿ç«¥ç«¯</button>
        </div>

        <!-- ç”¨æˆ·é€‰æ‹©å™¨ -->
        <div style="margin-bottom: 20px;">
            <div id="userSelector" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;"></div>
        </div>

        <div class="score-display">
            <div class="score-number" id="totalScore">0</div>
            <div class="score-label" id="scoreLabel">æˆ‘çš„æ˜Ÿæ˜Ÿç§¯åˆ†</div>
        </div>

        <div class="tabs" id="tabsContainer">
            <button class="tab-btn active" onclick="switchTab('chores')">ğŸ§¹ åšå®¶åŠ¡</button>
            <button class="tab-btn" onclick="switchTab('rewards')">ğŸ æ¢å¥–åŠ±</button>
            <button class="tab-btn" onclick="switchTab('myRewards')">ğŸ’ æˆ‘çš„å¥–åŠ±</button>
            <button class="tab-btn" onclick="switchTab('pending')" id="pendingTab" style="display: none;">
                â³ å¾…å®¡æ ¸
                <span class="badge" id="pendingBadge" style="display: none;">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('manage')" id="manageTab">âš™ï¸ ç®¡ç†</button>
        </div>

        <!-- å®¶åŠ¡åˆ—è¡¨ -->
        <div id="chores" class="tab-content active">
            <div id="choresList"></div>
        </div>

        <!-- å¥–åŠ±åˆ—è¡¨ -->
        <div id="rewards" class="tab-content">
            <div id="rewardsList"></div>
        </div>

        <!-- æˆ‘çš„å¥–åŠ± -->
        <div id="myRewards" class="tab-content">
            <div id="myRewardsList"></div>
        </div>

        <!-- å¾…å®¡æ ¸é¡µé¢ï¼ˆå®¶é•¿ç«¯ï¼‰ -->
        <div id="pending" class="tab-content">
            <div id="pendingList"></div>
        </div>

        <!-- ç®¡ç†é¡µé¢ -->
        <div id="manage" class="tab-content">
            <button class="add-btn" onclick="openAddUserModal()" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">ğŸ‘¶ æ·»åŠ å°å­©</button>
            <button class="add-btn" onclick="openAddChoreModal()">â• æ·»åŠ æ–°å®¶åŠ¡</button>
            <button class="add-btn" onclick="openAddRewardModal()">ğŸ æ·»åŠ æ–°å¥–åŠ±</button>
            <button class="add-btn" onclick="resetScore()" style="background: linear-gradient(135deg, #ff6b9d 0%, #ff8e53 100%);">ğŸ”„ é‡ç½®å½“å‰å°å­©ç§¯åˆ†</button>
        </div>
    </div>

    <!-- æ·»åŠ å®¶åŠ¡æ¨¡æ€æ¡† -->
    <div id="choreModal" class="modal">
        <div class="modal-content">
            <h2>â• æ·»åŠ æ–°å®¶åŠ¡</h2>
            <div class="form-group">
                <label>é€‰æ‹©å›¾æ ‡ï¼š</label>
                <div class="emoji-picker" id="choreEmojiPicker"></div>
            </div>
            <div class="form-group">
                <label>å®¶åŠ¡åç§°ï¼š</label>
                <input type="text" id="choreName" placeholder="ä¾‹å¦‚ï¼šæ‰“æ‰«æˆ¿é—´">
            </div>
            <div class="form-group">
                <label>è·å¾—ç§¯åˆ†ï¼š</label>
                <input type="number" id="chorePoints" placeholder="10" min="1">
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('choreModal')">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="addChore()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å¥–åŠ±æ¨¡æ€æ¡† -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ æ·»åŠ æ–°å¥–åŠ±</h2>
            <div class="form-group">
                <label>é€‰æ‹©å›¾æ ‡ï¼š</label>
                <div class="emoji-picker" id="rewardEmojiPicker"></div>
            </div>
            <div class="form-group">
                <label>å¥–åŠ±åç§°ï¼š</label>
                <input type="text" id="rewardName" placeholder="ä¾‹å¦‚ï¼šåƒå†°æ·‡æ·‹">
            </div>
            <div class="form-group">
                <label>éœ€è¦ç§¯åˆ†ï¼š</label>
                <input type="number" id="rewardCost" placeholder="20" min="1">
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('rewardModal')">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="addReward()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å°å­©æ¨¡æ€æ¡† -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ‘¶ æ·»åŠ å°å­©</h2>
            <div class="form-group">
                <label>å°å­©åå­—ï¼š</label>
                <input type="text" id="userName" placeholder="ä¾‹å¦‚ï¼šå°æ˜">
            </div>
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="closeModal('userModal')">å–æ¶ˆ</button>
                <button class="btn-primary" onclick="addUser()">æ·»åŠ </button>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡å¼ç®¡ç†
        let currentMode = localStorage.getItem('currentMode') || 'parent'; // 'parent' æˆ– 'child'

        // ç”¨æˆ·ç®¡ç†
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentUserId = localStorage.getItem('currentUserId') || null;

        // å¦‚æœæ²¡æœ‰ç”¨æˆ·ï¼Œåˆ›å»ºé»˜è®¤ç”¨æˆ·
        if (users.length === 0) {
            users = [{ id: Date.now(), name: 'å°å®è´' }];
            currentUserId = users[0].id.toString();
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('currentUserId', currentUserId);
        }

        // å¾…å®¡æ ¸å®¶åŠ¡åˆ—è¡¨ï¼ˆå…¨å±€ï¼Œä¸æŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
        let pendingChores = JSON.parse(localStorage.getItem('pendingChores')) || [];

        // æ•°æ®å­˜å‚¨ï¼ˆæŒ‰ç”¨æˆ·éš”ç¦»ï¼‰
        function getUserKey(key) {
            return `${key}_${currentUserId}`;
        }

        // æ•°æ®å­˜å‚¨
        let score = parseInt(localStorage.getItem(getUserKey('score'))) || 0;
        let chores = JSON.parse(localStorage.getItem(getUserKey('chores'))) || [
            { id: 1, icon: 'ğŸ§¹', name: 'æ‰“æ‰«æˆ¿é—´', points: 10 },
            { id: 2, icon: 'ğŸ½ï¸', name: 'æ´—ç¢—', points: 8 },
            { id: 3, icon: 'ğŸ—‘ï¸', name: 'å€’åƒåœ¾', points: 5 },
            { id: 4, icon: 'ğŸŒ±', name: 'æµ‡èŠ±', points: 5 },
            { id: 5, icon: 'ğŸ“š', name: 'æ•´ç†ä¹¦æ¡Œ', points: 8 },
            { id: 6, icon: 'ğŸ‘•', name: 'æ”¶æ‹¾è¡£æœ', points: 6 }
        ];
        let rewards = JSON.parse(localStorage.getItem(getUserKey('rewards'))) || [
            { id: 1, icon: 'ğŸ¦', name: 'åƒä¸€æ¬¡å†°æ·‡æ·‹', cost: 20 },
            { id: 2, icon: 'ğŸ®', name: 'ç©30åˆ†é’Ÿæ¸¸æˆ', cost: 30 },
            { id: 3, icon: 'ğŸ¬', name: 'çœ‹ä¸€éƒ¨ç”µå½±', cost: 50 },
            { id: 4, icon: 'ğŸ', name: 'å°ç©å…·', cost: 100 }
        ];
        let redeemedRewards = JSON.parse(localStorage.getItem(getUserKey('redeemedRewards'))) || [];

        const choreEmojis = [
            'ğŸ§¹', 'ğŸ½ï¸', 'ğŸ—‘ï¸', 'ğŸŒ±', 'ğŸ“š', 'ğŸ‘•', 'ğŸ§º', 'ğŸª´', 'ğŸ§½', 'ğŸ§´', 'ğŸ›ï¸', 'ğŸªŸ',
            'ğŸ§¸', 'ğŸª€', 'ğŸ²', 'ğŸ§©', 'ğŸ‘Ÿ', 'ğŸ‘', 'ğŸ§¤', 'ğŸ§¦', 'ğŸ¥¤', 'ğŸ´', 'ğŸ¥„', 'ğŸª£',
            'ğŸ›', 'ğŸš¿', 'ğŸš½', 'ğŸª', 'ğŸ›‹ï¸', 'ğŸª‘', 'ğŸ›’', 'ğŸ“¦', 'ğŸ’', 'ğŸ–¼ï¸', 'ğŸ•°ï¸', 'ğŸ«§'
        ];
        const rewardEmojis = [
            'ğŸ¦', 'ğŸ®', 'ğŸ¬', 'ğŸ', 'ğŸ•', 'ğŸ°', 'ğŸ¨', 'âš½', 'ğŸª', 'ğŸ¯', 'ğŸ¸', 'ğŸ“±',
            'ğŸ¿', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ§', 'ğŸ©', 'ğŸ‚', 'ğŸ¥¤', 'ğŸ§ƒ', 'ğŸŒ', 'ğŸ', 'ğŸ“',
            'ğŸˆ', 'ğŸ‰', 'ğŸŠ', 'ğŸ€', 'ğŸ¾', 'ğŸ', 'ğŸ±', 'ğŸ›´', 'ğŸ›¹', 'ğŸš²', 'ğŸ¢', 'ğŸ¡',
            'ğŸ“º', 'ğŸ’»', 'âŒš', 'ğŸ“·', 'ğŸ§', 'ğŸ¤', 'ğŸ¹', 'ğŸº', 'ğŸ»', 'ğŸ¥', 'ğŸ­', 'ğŸª'
        ];

        let selectedChoreEmoji = choreEmojis[0];
        let selectedRewardEmoji = rewardEmojis[0];

        // åˆå§‹åŒ–
        function init() {
            updateModeUI();
            renderUserSelector();
            updateScore();
            renderChores();
            renderRewards();
            renderRedeemedRewards();
            renderPendingChores();
            createEmojiPicker('choreEmojiPicker', choreEmojis, 'chore');
            createEmojiPicker('rewardEmojiPicker', rewardEmojis, 'reward');
        }

        // æ¨¡å¼åˆ‡æ¢
        function switchMode(mode) {
            currentMode = mode;
            localStorage.setItem('currentMode', mode);
            updateModeUI();
            renderChores();
            renderPendingChores();
        }

        function updateModeUI() {
            const parentBtn = document.getElementById('parentModeBtn');
            const childBtn = document.getElementById('childModeBtn');
            const pendingTab = document.getElementById('pendingTab');
            const manageTab = document.getElementById('manageTab');

            if (currentMode === 'parent') {
                parentBtn.style.border = '3px solid #ff6b9d';
                parentBtn.style.background = 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)';
                childBtn.style.border = '3px solid #e0e0e0';
                childBtn.style.background = 'white';
                pendingTab.style.display = 'block';
                manageTab.style.display = 'block';
            } else {
                childBtn.style.border = '3px solid #ff6b9d';
                childBtn.style.background = 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)';
                parentBtn.style.border = '3px solid #e0e0e0';
                parentBtn.style.background = 'white';
                pendingTab.style.display = 'none';
                manageTab.style.display = 'none';
            }
        }

        function updateScore() {
            document.getElementById('totalScore').textContent = score;
            const currentUser = users.find(u => u.id.toString() === currentUserId);
            if (currentUser) {
                document.getElementById('scoreLabel').textContent = `${currentUser.name}çš„æ˜Ÿæ˜Ÿç§¯åˆ†`;
            }
            localStorage.setItem(getUserKey('score'), score);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function renderChores() {
            const choresList = document.getElementById('choresList');
            if (currentMode === 'child') {
                // å„¿ç«¥ç«¯ï¼šæ˜¾ç¤ºæäº¤æŒ‰é’®
                choresList.innerHTML = chores.map(chore => `
                    <div class="chore-card">
                        <div class="chore-info">
                            <div class="chore-icon">${chore.icon}</div>
                            <div class="chore-details">
                                <h3>${chore.name}</h3>
                                <div class="chore-points">â­ ${chore.points} åˆ†</div>
                            </div>
                        </div>
                        <button class="complete-btn" onclick="submitChore(${chore.id})">
                            æäº¤ ğŸ“
                        </button>
                    </div>
                `).join('');
            } else {
                // å®¶é•¿ç«¯ï¼šæ˜¾ç¤ºç›´æ¥å®ŒæˆæŒ‰é’®
                choresList.innerHTML = chores.map(chore => `
                    <div class="chore-card">
                        <div class="chore-info">
                            <div class="chore-icon">${chore.icon}</div>
                            <div class="chore-details">
                                <h3>${chore.name}</h3>
                                <div class="chore-points">â­ ${chore.points} åˆ†</div>
                            </div>
                        </div>
                        <button class="complete-btn" onclick="completeChore(${chore.id}, ${chore.points})">
                            å®Œæˆ âœ“
                        </button>
                    </div>
                `).join('');
            }
        }

        function renderRewards() {
            const rewardsList = document.getElementById('rewardsList');
            rewardsList.innerHTML = rewards.map(reward => `
                <div class="reward-card">
                    <div class="reward-header">
                        <div class="reward-icon">${reward.icon}</div>
                        <div class="reward-info">
                            <h3>${reward.name}</h3>
                            <div class="reward-cost">éœ€è¦ â­ ${reward.cost} åˆ†</div>
                        </div>
                    </div>
                    <button class="redeem-btn" onclick="redeemReward(${reward.id}, ${reward.cost})" 
                            ${score < reward.cost ? 'disabled' : ''}>
                        ${score < reward.cost ? 'ç§¯åˆ†ä¸å¤Ÿå“¦ ğŸ˜¢' : 'å…‘æ¢å¥–åŠ± ğŸ‰'}
                    </button>
                </div>
            `).join('');
        }

        // å„¿ç«¥ç«¯ï¼šæäº¤å®¶åŠ¡
        function submitChore(choreId) {
            const chore = chores.find(c => c.id === choreId);
            if (chore) {
                const pendingChore = {
                    id: Date.now(),
                    choreId: chore.id,
                    userId: currentUserId,
                    userName: users.find(u => u.id.toString() === currentUserId).name,
                    icon: chore.icon,
                    name: chore.name,
                    points: chore.points,
                    submitTime: new Date().toLocaleString('zh-CN')
                };
                pendingChores.push(pendingChore);
                localStorage.setItem('pendingChores', JSON.stringify(pendingChores));
                showCelebration('ğŸ“');
                alert('å®¶åŠ¡å·²æäº¤ï¼Œç­‰å¾…å®¶é•¿å®¡æ ¸ï¼');
            }
        }

        // å®¶é•¿ç«¯ï¼šç›´æ¥å®Œæˆå®¶åŠ¡ï¼ˆç»™ç§¯åˆ†ï¼‰
        function completeChore(choreId, points) {
            score += points;
            updateScore();
            showCelebration('ğŸŒŸ');
            renderRewards(); // æ›´æ–°å¥–åŠ±æŒ‰é’®çŠ¶æ€
        }

        // å®¶é•¿ç«¯ï¼šæ¸²æŸ“å¾…å®¡æ ¸åˆ—è¡¨
        function renderPendingChores() {
            const pendingList = document.getElementById('pendingList');
            const pendingBadge = document.getElementById('pendingBadge');

            // æ›´æ–°å¾½ç« 
            if (pendingChores.length > 0) {
                pendingBadge.textContent = pendingChores.length;
                pendingBadge.style.display = 'inline-block';
            } else {
                pendingBadge.style.display = 'none';
            }

            if (pendingChores.length === 0) {
                pendingList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <div style="font-size: 80px; margin-bottom: 20px;">â³</div>
                        <div style="font-size: 24px;">æš‚æ— å¾…å®¡æ ¸çš„å®¶åŠ¡</div>
                    </div>
                `;
            } else {
                pendingList.innerHTML = pendingChores.map(pending => `
                    <div class="chore-card" style="background: linear-gradient(135deg, #fff9e6 0%, #ffe6cc 100%);">
                        <div class="chore-info">
                            <div class="chore-icon">${pending.icon}</div>
                            <div class="chore-details">
                                <h3>${pending.name}</h3>
                                <div class="chore-points">â­ ${pending.points} åˆ†</div>
                                <div style="font-size: 14px; color: #666; margin-top: 5px;">
                                    ${pending.userName} Â· ${pending.submitTime}
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; flex-direction: column;">
                            <button class="complete-btn" onclick="approveChore(${pending.id})" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
                                é€šè¿‡ âœ“
                            </button>
                            <button class="complete-btn" onclick="rejectChore(${pending.id})" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                                æ‹’ç» âœ—
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        // å®¶é•¿ç«¯ï¼šå®¡æ ¸é€šè¿‡
        function approveChore(pendingId) {
            const pending = pendingChores.find(p => p.id === pendingId);
            if (pending) {
                // ç»™å¯¹åº”ç”¨æˆ·åŠ ç§¯åˆ†
                const targetUserId = pending.userId;
                const oldUserId = currentUserId;

                // ä¸´æ—¶åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·ï¼ŒåŠ ç§¯åˆ†
                currentUserId = targetUserId;
                score = parseInt(localStorage.getItem(getUserKey('score'))) || 0;
                score += pending.points;
                localStorage.setItem(getUserKey('score'), score);

                // åˆ‡æ¢å›å½“å‰ç”¨æˆ·
                currentUserId = oldUserId;
                loadUserData();

                // ä»å¾…å®¡æ ¸åˆ—è¡¨åˆ é™¤
                pendingChores = pendingChores.filter(p => p.id !== pendingId);
                localStorage.setItem('pendingChores', JSON.stringify(pendingChores));

                renderPendingChores();
                showCelebration('âœ“');
                alert(`å·²é€šè¿‡ ${pending.userName} çš„å®¶åŠ¡ç”³è¯·ï¼`);
            }
        }

        // å®¶é•¿ç«¯ï¼šå®¡æ ¸æ‹’ç»
        function rejectChore(pendingId) {
            const pending = pendingChores.find(p => p.id === pendingId);
            if (pending && confirm(`ç¡®å®šè¦æ‹’ç» ${pending.userName} çš„å®¶åŠ¡ç”³è¯·å—ï¼Ÿ`)) {
                pendingChores = pendingChores.filter(p => p.id !== pendingId);
                localStorage.setItem('pendingChores', JSON.stringify(pendingChores));
                renderPendingChores();
            }
        }

        function redeemReward(rewardId, cost) {
            if (score >= cost) {
                score -= cost;
                updateScore();

                // æ‰¾åˆ°è¢«å…‘æ¢çš„å¥–åŠ±
                const reward = rewards.find(r => r.id === rewardId);
                if (reward) {
                    // æ£€æŸ¥æ˜¯å¦å·²ç»å…‘æ¢è¿‡è¿™ä¸ªå¥–åŠ±
                    const existingReward = redeemedRewards.find(r => r.id === rewardId);
                    if (existingReward) {
                        // å¢åŠ æ•°é‡
                        existingReward.count++;
                    } else {
                        // æ·»åŠ æ–°å¥–åŠ±
                        redeemedRewards.push({
                            id: reward.id,
                            icon: reward.icon,
                            name: reward.name,
                            count: 1
                        });
                    }
                    localStorage.setItem(getUserKey('redeemedRewards'), JSON.stringify(redeemedRewards));
                    renderRedeemedRewards();
                }

                showCelebration('ğŸ‰');
                renderRewards();
            }
        }

        function showCelebration(emoji) {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = emoji;
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 1000);
        }

        function createEmojiPicker(pickerId, emojis, type) {
            const picker = document.getElementById(pickerId);
            picker.innerHTML = emojis.map(emoji => `
                <div class="emoji-option ${emoji === (type === 'chore' ? selectedChoreEmoji : selectedRewardEmoji) ? 'selected' : ''}" 
                     onclick="selectEmoji('${emoji}', '${type}', '${pickerId}')">
                    ${emoji}
                </div>
            `).join('');
        }

        function selectEmoji(emoji, type, pickerId) {
            if (type === 'chore') {
                selectedChoreEmoji = emoji;
            } else {
                selectedRewardEmoji = emoji;
            }
            document.querySelectorAll(`#${pickerId} .emoji-option`).forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
        }

        function openAddChoreModal() {
            document.getElementById('choreModal').classList.add('active');
        }

        function openAddRewardModal() {
            document.getElementById('rewardModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function addChore() {
            const name = document.getElementById('choreName').value;
            const points = parseInt(document.getElementById('chorePoints').value);
            
            if (name && points) {
                const newChore = {
                    id: Date.now(),
                    icon: selectedChoreEmoji,
                    name: name,
                    points: points
                };
                chores.push(newChore);
                localStorage.setItem(getUserKey('chores'), JSON.stringify(chores));
                renderChores();
                closeModal('choreModal');
                document.getElementById('choreName').value = '';
                document.getElementById('chorePoints').value = '';
            }
        }

        function addReward() {
            const name = document.getElementById('rewardName').value;
            const cost = parseInt(document.getElementById('rewardCost').value);
            
            if (name && cost) {
                const newReward = {
                    id: Date.now(),
                    icon: selectedRewardEmoji,
                    name: name,
                    cost: cost
                };
                rewards.push(newReward);
                localStorage.setItem(getUserKey('rewards'), JSON.stringify(rewards));
                renderRewards();
                closeModal('rewardModal');
                document.getElementById('rewardName').value = '';
                document.getElementById('rewardCost').value = '';
            }
        }

        function resetScore() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç§¯åˆ†å—ï¼Ÿ')) {
                score = 0;
                updateScore();
                renderRewards();
            }
        }

        function renderRedeemedRewards() {
            const myRewardsList = document.getElementById('myRewardsList');
            if (redeemedRewards.length === 0) {
                myRewardsList.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #999;">
                        <div style="font-size: 80px; margin-bottom: 20px;">ğŸ’</div>
                        <div style="font-size: 24px;">è¿˜æ²¡æœ‰å…‘æ¢å¥–åŠ±å“¦</div>
                        <div style="font-size: 16px; margin-top: 10px;">å¿«å»åšå®¶åŠ¡èµšç§¯åˆ†å§ï¼</div>
                    </div>
                `;
            } else {
                myRewardsList.innerHTML = redeemedRewards.map(reward => `
                    <div class="reward-card">
                        <div class="reward-header">
                            <div class="reward-icon">${reward.icon}</div>
                            <div class="reward-info">
                                <h3>${reward.name}</h3>
                                <div class="reward-cost">å‰©ä½™ ${reward.count} æ¬¡</div>
                            </div>
                        </div>
                        <button class="redeem-btn" onclick="useReward(${reward.id})">
                            ä½¿ç”¨å¥–åŠ± âœ¨
                        </button>
                    </div>
                `).join('');
            }
        }

        function useReward(rewardId) {
            const reward = redeemedRewards.find(r => r.id === rewardId);
            if (reward) {
                reward.count--;

                // å¦‚æœæ•°é‡ä¸º 0ï¼Œä»åˆ—è¡¨ä¸­ç§»é™¤
                if (reward.count === 0) {
                    redeemedRewards = redeemedRewards.filter(r => r.id !== rewardId);
                }

                localStorage.setItem(getUserKey('redeemedRewards'), JSON.stringify(redeemedRewards));
                renderRedeemedRewards();
                showCelebration('âœ¨');
            }
        }

        // ç”¨æˆ·ç®¡ç†åŠŸèƒ½
        function renderUserSelector() {
            const userSelector = document.getElementById('userSelector');
            userSelector.innerHTML = users.map(user => `
                <button
                    onclick="switchUser(${user.id})"
                    style="padding: 12px 24px;
                           border: 3px solid ${user.id.toString() === currentUserId ? '#ff6b9d' : '#e0e0e0'};
                           background: ${user.id.toString() === currentUserId ? 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)' : 'white'};
                           border-radius: 15px;
                           font-size: 18px;
                           font-weight: bold;
                           cursor: pointer;
                           transition: all 0.3s;
                           position: relative;"
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'">
                    ${user.name}
                    ${users.length > 1 ? `<span onclick="event.stopPropagation(); deleteUser(${user.id})" style="margin-left: 8px; color: #ff4757; font-size: 14px; cursor: pointer;">âœ•</span>` : ''}
                </button>
            `).join('');
        }

        function switchUser(userId) {
            currentUserId = userId.toString();
            localStorage.setItem('currentUserId', currentUserId);
            loadUserData();
            renderUserSelector();
            updateScore();
            renderChores();
            renderRewards();
            renderRedeemedRewards();
        }

        function loadUserData() {
            score = parseInt(localStorage.getItem(getUserKey('score'))) || 0;
            chores = JSON.parse(localStorage.getItem(getUserKey('chores'))) || [
                { id: 1, icon: 'ğŸ§¹', name: 'æ‰“æ‰«æˆ¿é—´', points: 10 },
                { id: 2, icon: 'ğŸ½ï¸', name: 'æ´—ç¢—', points: 8 },
                { id: 3, icon: 'ğŸ—‘ï¸', name: 'å€’åƒåœ¾', points: 5 },
                { id: 4, icon: 'ğŸŒ±', name: 'æµ‡èŠ±', points: 5 },
                { id: 5, icon: 'ğŸ“š', name: 'æ•´ç†ä¹¦æ¡Œ', points: 8 },
                { id: 6, icon: 'ğŸ‘•', name: 'æ”¶æ‹¾è¡£æœ', points: 6 }
            ];
            rewards = JSON.parse(localStorage.getItem(getUserKey('rewards'))) || [
                { id: 1, icon: 'ğŸ¦', name: 'åƒä¸€æ¬¡å†°æ·‡æ·‹', cost: 20 },
                { id: 2, icon: 'ğŸ®', name: 'ç©30åˆ†é’Ÿæ¸¸æˆ', cost: 30 },
                { id: 3, icon: 'ğŸ¬', name: 'çœ‹ä¸€éƒ¨ç”µå½±', cost: 50 },
                { id: 4, icon: 'ğŸ', name: 'å°ç©å…·', cost: 100 }
            ];
            redeemedRewards = JSON.parse(localStorage.getItem(getUserKey('redeemedRewards'))) || [];
        }

        function openAddUserModal() {
            document.getElementById('userModal').classList.add('active');
        }

        function addUser() {
            const name = document.getElementById('userName').value.trim();
            if (name) {
                const newUser = {
                    id: Date.now(),
                    name: name
                };
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                renderUserSelector();
                closeModal('userModal');
                document.getElementById('userName').value = '';
                showCelebration('ğŸ‘¶');
            }
        }

        function deleteUser(userId) {
            if (users.length <= 1) {
                alert('è‡³å°‘è¦ä¿ç•™ä¸€ä¸ªå°å­©å“¦ï¼');
                return;
            }

            const user = users.find(u => u.id === userId);
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${user.name} å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®ï¼`)) {
                // åˆ é™¤ç”¨æˆ·æ•°æ®
                localStorage.removeItem(`score_${userId}`);
                localStorage.removeItem(`chores_${userId}`);
                localStorage.removeItem(`rewards_${userId}`);
                localStorage.removeItem(`redeemedRewards_${userId}`);

                // ä»ç”¨æˆ·åˆ—è¡¨ä¸­ç§»é™¤
                users = users.filter(u => u.id !== userId);
                localStorage.setItem('users', JSON.stringify(users));

                // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰ç”¨æˆ·ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªç”¨æˆ·
                if (userId.toString() === currentUserId) {
                    switchUser(users[0].id);
                } else {
                    renderUserSelector();
                }
            }
        }

        // å¯åŠ¨åº”ç”¨
        init();
    </script>
</body>
</html>
